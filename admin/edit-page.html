<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Halaman - E-PEDIA Admin</title>
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body>
    <div class="admin-container">
        <header>
            <h1>Edit Halaman</h1>
            <a href="index.html" class="back-button">Kembali ke Dashboard</a>
        </header>
        
        <main>
            <form id="edit-page-form">
                <input type="hidden" id="page-id">
                
                <div class="form-group">
                    <label for="page-title">Judul Halaman:</label>
                    <input type="text" id="page-title" required>
                </div>
                
                <div class="form-group">
                    <label for="page-number">Nomor Halaman:</label>
                    <input type="number" id="page-number" min="1" required>
                </div>
                
                <div class="form-group">
                    <label for="page-content">Isi Konten:</label>
                    <textarea id="page-content" rows="15" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Posisi Gambar:</label>
                    <div class="image-positions">
                        <div class="image-position">
                            <label for="top-image">Gambar Atas:</label>
                            <select id="top-image" class="image-selector">
                                <option value="">Tidak ada gambar</option>
                            </select>
                            <div class="image-preview" id="top-preview"></div>
                        </div>
                        
                        <div class="image-position">
                            <label for="center-image">Gambar Tengah:</label>
                            <select id="center-image" class="image-selector">
                                <option value="">Tidak ada gambar</option>
                            </select>
                            <div class="image-preview" id="center-preview"></div>
                        </div>
                        
                        <div class="image-position">
                            <label for="bottom-image">Gambar Bawah:</label>
                            <select id="bottom-image" class="image-selector">
                                <option value="">Tidak ada gambar</option>
                            </select>
                            <div class="image-preview" id="bottom-preview"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="save-button">Simpan Perubahan</button>
                    <button type="button" id="delete-page" class="delete-button">Hapus Halaman</button>
                </div>
            </form>
        </main>
    </div>
    
    <script src="../js/admin.js"></script>
    <script>
        // Load page data based on URL parameter
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const pageId = urlParams.get('id');
            
            if (pageId) {
                // Load page data from localStorage or API
                const pages = JSON.parse(localStorage.getItem('e-pedia-pages')) || [];
                const page = pages.find(p => p.id == pageId);
                
                if (page) {
                    document.getElementById('page-id').value = page.id;
                    document.getElementById('page-title').value = page.title;
                    document.getElementById('page-number').value = page.number;
                    document.getElementById('page-content').value = page.content;
                    
                    // Set image selections
                    if (page.topImage) {
                        document.getElementById('top-image').value = page.topImage;
                        updateImagePreview('top-preview', page.topImage);
                    }
                    if (page.centerImage) {
                        document.getElementById('center-image').value = page.centerImage;
                        updateImagePreview('center-preview', page.centerImage);
                    }
                    if (page.bottomImage) {
                        document.getElementById('bottom-image').value = page.bottomImage;
                        updateImagePreview('bottom-preview', page.bottomImage);
                    }
                    
                    // Load available images
                    loadImageOptions();
                }
            }
            
            // Form submission
            document.getElementById('edit-page-form').addEventListener('submit', function(e) {
                e.preventDefault();
                savePage();
            });
            
            // Image select change handlers
            document.getElementById('top-image').addEventListener('change', function() {
                updateImagePreview('top-preview', this.value);
            });
            
            document.getElementById('center-image').addEventListener('change', function() {
                updateImagePreview('center-preview', this.value);
            });
            
            document.getElementById('bottom-image').addEventListener('change', function() {
                updateImagePreview('bottom-preview', this.value);
            });
            
            // Delete button
            document.getElementById('delete-page').addEventListener('click', function() {
                if (confirm('Apakah Anda yakin ingin menghapus halaman ini?')) {
                    deletePage();
                }
            });
        });
        
        function loadImageOptions() {
            // Load images from localStorage or API
            const images = JSON.parse(localStorage.getItem('e-pedia-images')) || [];
            const selectors = ['top-image', 'center-image', 'bottom-image'];
            
            selectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                // Clear existing options except the first one
                while (selector.options.length > 1) {
                    selector.remove(1);
                }
                
                // Add image options
                images.forEach(image => {
                    const option = document.createElement('option');
                    option.value = image.url;
                    option.textContent = image.name;
                    selector.appendChild(option);
                });
            });
        }
        
        function updateImagePreview(previewId, imageUrl) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            
            if (imageUrl) {
                const img = document.createElement('img');
                img.src = '../images/' + imageUrl;
                img.alt = 'Preview';
                preview.appendChild(img);
            }
        }
        
        function savePage() {
            const pageData = {
                id: document.getElementById('page-id').value || Date.now().toString(),
                title: document.getElementById('page-title').value,
                number: parseInt(document.getElementById('page-number').value),
                content: document.getElementById('page-content').value,
                topImage: document.getElementById('top-image').value || null,
                centerImage: document.getElementById('center-image').value || null,
                bottomImage: document.getElementById('bottom-image').value || null
            };
            
            // Save to localStorage or API
            let pages = JSON.parse(localStorage.getItem('e-pedia-pages')) || [];
            const existingIndex = pages.findIndex(p => p.id == pageData.id);
            
            if (existingIndex >= 0) {
                pages[existingIndex] = pageData;
            } else {
                pages.push(pageData);
            }
            
            localStorage.setItem('e-pedia-pages', JSON.stringify(pages));
            
            alert('Halaman berhasil disimpan!');
            window.location.href = 'index.html';
        }
        
        function deletePage() {
            const pageId = document.getElementById('page-id').value;
            
            if (pageId) {
                let pages = JSON.parse(localStorage.getItem('e-pedia-pages')) || [];
                pages = pages.filter(p => p.id != pageId);
                localStorage.setItem('e-pedia-pages', JSON.stringify(pages));
                
                alert('Halaman berhasil dihapus!');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>
